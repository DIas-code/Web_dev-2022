(window.webpackJsonp=window.webpackJsonp||[]).push([["6s7b"],{fKkd:function(t,e){!function(){window.WebpageTester=function(t){this.initialize(t),this.bindTestContext(),this.testContext.phoneHome=t.output.phoneHome.bind(t.output)},WebpageTester.prototype=new OutputTester,_.extend(WebpageTester.prototype,{test:function(t,e,s,r){var n=this,i=[];s=this.errors=s||[],this.userCode=t,this.tests=[],this.exec(e),this.testContext.allScripts="",(new DOMParser).parseFromString(t,"text/html").querySelectorAll("script").forEach((function(t){n.testContext.allScripts+=t.innerHTML,n.testContext.allScripts+="\n"})),this.curTask=null,this.curTest=null,this.syncTests=!0;for(var o=0;o<this.tests.length;o++)i.push(this.runTest(this.tests[o],o));this.syncTests=!1,r(s,i)}});var t=function(t){return function(){return{variables:arguments,fn:t}}};WebpageTester.prototype.testMethods=_.clone(window.PJSTester.prototype.testMethods),_.extend(WebpageTester.prototype.testMethods,{scriptTest:function(){this.testContext.staticTest.apply(this,arguments)},uiTest:function(t,e,s,r,n){var i=function(){var t=this.curTest;t.state="fail";var i={type:"assertion",msg:s,state:"fail",expected:"",meta:{structure:r,image:n}};t.results=[i],e(function(e,s){var r=e?"pass":"fail";t.state=r,i.state=r,delete i.meta.alsoMessage,delete i.meta.alternateMessage,s&&(i.meta[e?"alternateMessage":"alsoMessage"]=s),this.syncTests||this.testContext.phoneHome()}.bind(this))}.bind(this);this.testContext.test(t,i,"ui")},constraintPartial:t,constraint:function(t,e){if(!e){t=/^function\s*[^\(]*\(([^\)]*)\)/.exec((e=t).toString())[1].match(/[$_a-zA-z0-9]+/g);for(var s in t)if("$"!==t[s][0])return console.warn("Invalid variable in constraint (should begin with a '$'): ",t[s]),null}return{variables:t,fn:e}},cleanStructure:function(t){if("string"==typeof t){var e={};e[t]=1,t=e}return t},htmlMatch:function(t){if(this.errors.length)return{success:!1};for(var e in t=this.testContext.cleanStructure(t)){var s=t[e],r=this.testContext.docSP.querySelectorAll(e).length;if(0===s&&0!==r||r<s)return{success:!1}}return{success:!0}},getCssMap:function(){var t={};return _.each(this.testContext.cssRules,function(e){var s={};_.each(e.declarations.properties,function(t){var e=this.testContext.normalizePropertyValue(t.value.value);s[t.name.value]=e}.bind(this));var r=[e.selector.value];-1!==r[0].indexOf(",")&&r.push.apply(r,r[0].split(",")),_.each(r,function(e){for(var r in(e=this.testContext.normalizeSelector(e))in t||(t[e]={}),s)t[e][r]=s[r]}.bind(this))}.bind(this)),t},cssMatch:function(t,e){if(this.errors.length)return{success:!1};var s=this.testContext.getCssMap(),r=t.split("}").slice(0,-1);return _.isArray(e)||_.isUndefined(e)||(e=[e]),e=_.map(e,function(t){return"function"==typeof t?this.testContext.constraint(t):t}.bind(this)),this.testContext.testCSSRules(r,s,e,{})},normalizePropertyValue:function(t){return t.replace(/\s+/g," ").replace(", ",",").trim()},normalizeSelector:function(t){var e=(t=t.replace(/\s+/g," ").replace(/(>|~|,) /g,"$1")).split(",");return t=(e=e.map((function(t){return t.trim()}))).sort().join(",")},testCSSRules:function(t,e,s,r){if(r=r||{},0===t.length)return this.testContext.checkCallbacks(s||[],r);var n=t.shift(),i=n.split("{"),o=this.testContext.normalizeSelector(i[0]),a=i[1],c={};_.each(a.split(";"),function(t){if(0!==t.trim().length){var e=t.split(":");c[e[0].trim()]=this.testContext.normalizePropertyValue(e[1])}}.bind(this));var u=r,l={success:!1};for(var h in e){if(r=Object.create(u),this.testContext.selectorMatch(o,h,r))if(_.every(c,function(t,s){return s in e[h]&&this.testContext.wildcardMatch(t,e[h][s],r)}.bind(this))){var p=this.testContext.testCSSRules(t,e,s,r);if(p.success)return p;l=p}}return t.unshift(n),l},wildcardMatch:function(t,e,s){return"_"===t||("$"===t[0]?t in s?s[t]===e:(s[t]=e,!0):t===e)},checkCallbacks:function(t,e){for(var s=0;s<t.length;s++){var r=t[s],n=_.map(r.variables,(function(t){return"string"==typeof t&&"$"===t[0]?e[t]:t})),i=r.fn.apply({},n);if(!1===i)return{success:!1};if(!1===i.success)return i}return{success:!0}},selectorMatch:function(t,e,s){return this.testContext.multiSelectorMatch(t.split(","),e.split(","),s)},multiSelectorMatch:function(t,e,s){if(t.length!==e.length)return!1;if(0===t.length)return!0;for(var r=s=s||{},n=t.shift(),i=0;i<e.length;i++){s=Object.create(r);var o=e[i];if(this.testContext.singleSelectorMatch(n,o,s)&&this.testContext.multiSelectorMatch(t,e.slice(0,i).concat(e.slice(i+1)),s)){for(i in s)i in r||(r[i]=s[i]);return!0}}return t.unshift(n),!1},singleSelectorMatch:function(t,e,s){var r=t.split(" "),n=e.split(" ");if(r.length!==n.length)return!1;for(var i=0;i<r.length;i++)if(!this.testContext.wildcardMatch(r[i],n[i],s))return!1;return!0},htmlMatches:function(t){return this.testContext.htmlMatch.apply(this,arguments).success},cssMatches:function(t,e){return this.testContext.cssMatch.apply(this,arguments).success},notDefaultColor:t((function(t){var e=/rgb\((\s*\d+,){2}(\s*\d+\s*)\)/.test(t)||/rgba\((\s*\d+,){3}(\s*\d+\s*)\)/.test(t),s="rgb(255,0,0)"===t.replace(/\s+/,"");return e&&!s})),isValidColor:t((function(t){var e=function(t){var e=parseInt(t,10);return e>=0&&e<=255};if(/rgb\((\s*\d+,){2}(\s*\d+\s*)\)/.test(t)||/rgba\((\s*\d+,){3}(\s*\d+\s*)\)/.test(t)){var s=t.split("(")[1].split(",");return e(s[0])&&e(s[1])&&e(s[2])}return/[a-zA-Z]+/.test(t)&&t.length>=3&&-1===t.indexOf("rgb")})),assertMatch:function(t,e,s,r,n){var i,o;this.testContext._checkSyntaxErrors(n),t.success?i=t.message:o=t.message,this.testContext.assert(t.success,e,"",{structure:s?s.toString():"",alternateMessage:i,alsoMessage:o,image:r})},match:function(t){if(this.errors.length)return{success:!1,message:i18n._("Syntax error!")};if(t&&_.isUndefined(t.pattern)&&(t={pattern:t}),!t||!t.pattern)return{success:!1,message:""};try{var e=t.constraint;return{success:Structured.match(this.testContext.allScripts,t.pattern,{varCallbacks:e}),message:e&&e.failure}}catch(t){return console.warn(t),{success:!0,message:i18n._("Hm, we're having some trouble verifying your answer for this step, so we'll give you the benefit of the doubt as we work to fix it. Please click \"Report a problem\" to notify us.")}}}})}(),window.WebpageOutput=Backbone.View.extend({initialize:function(t){this.config=t.config,this.output=t.output,this.tester=new WebpageTester(t),this.render(),this.config.runCurVersion("webpage",this),this.loopProtector=new LoopProtector(this.infiniteLoopCallback.bind(this)),this.$frame.contentWindow.KAInfiniteLoopProtect=this.loopProtector.KAInfiniteLoopProtect,this.$frame.addEventListener("load",function(){this.$frame.contentWindow.KAInfiniteLoopProtect=this.loopProtector.KAInfiniteLoopProtect}.bind(this)),this.stateScrubber=new StateScrubber(this.$frame.contentWindow)},render:function(){this.$el.empty(),this.$frame=$("<iframe>").css({width:"100%",height:"100%",border:"0"}).appendTo(this.el).show()[0],this.frameDoc=this.$frame.contentDocument},getScreenshot:function(t,e){html2canvas(this.frameDoc.body,{imagesDir:this.output.imagesDir,onrendered:function(s){var r=t,n=t/s.width*s.height,i=document.createElement("canvas");i.width=t,i.height=t,i.getContext("2d").drawImage(s,0,0,r,n),e(i.toDataURL("image/png"))}})},infiniteLoopError:{text:i18n._("Your javascript is taking too long to run. Perhaps you have a mistake in your code?"),type:"error",source:"timeout"},runtimeError:{text:i18n._("Your javascript encountered a runtime error. Check your console for more information."),type:"error",source:"timeout"},infiniteLoopCallback:function(){this.output.postParent({results:{code:this.output.currentCode,errors:[this.infiniteLoopError]}}),this.KA_INFINITE_LOOP=!0},lint:function(t,e){var s=this,r=$.Deferred();if(e)return r.resolve({errors:[],warnings:[]}),r;this.userCode=t,t=t||"";var n={};try{n=Slowparse.HTML(document,t,{scriptPreprocessor:function(t){return s.loopProtector.protect(t)},disableTags:["iframe","embed","object","frameset","frame"]})}catch(t){console.warn(t),n.error={type:"UNKNOWN_SLOWPARSE_ERROR"}}this.slowparseResults=n;var i=[];if(n.error){var o=(u=n.error.cursor||0)-(l=t.slice(0,u)).lastIndexOf("\n")-1;i=[{row:h=(l.match(/\n/g)||[]).length,column:o,text:this.getLintMessage(n.error),type:"error",source:"slowparse",lint:n.error,priority:2}]}var a=[];if(n.warnings&&n.warnings.length>0)for(var c=0;c<n.warnings.length;c++){o=(u=n.warnings[c].parseInfo.cursor||0)-(l=t.slice(0,u)).lastIndexOf("\n")-1;var u,l,h=(l.match(/\n/g)||[]).length;a.push({row:h,column:o,text:this.getLintMessage(n.warnings[c].parseInfo),type:"warning",source:"slowparse"})}return r.resolve({errors:i,warnings:a}),r},flattenError:function(t,e,s){for(var r in e=e||{},s=s||"",t)if(t.hasOwnProperty(r)){var n=s?s+"_"+r:r;"object"==typeof t[r]?this.flattenError(t[r],e,n):e[n]=t[r]}return e},getLintMessage:function(t){var e=this.flattenError(t);return{NO_DOCTYPE_FOUND:i18n._("A DOCTYPE declaration should be the first item on the page.",e),HTML_NOT_ROOT_ELEMENT:i18n._("The root element on the page should be an <html> element.",e),ATTRIBUTE_IN_CLOSING_TAG:i18n._('A closing "&lt;/%(closeTag_name)s&gt;" tag cannot contain any attributes.',e),CLOSE_TAG_FOR_VOID_ELEMENT:i18n._('You have a closing "&lt;/%(closeTag_name)s&gt;" tag for a void element (and void elements don\'t need to be closed).',e),CSS_MIXED_ACTIVECONTENT:i18n._('You have a css property "%(cssProperty_property)s" with a "url()" value that currently points to an insecure resource.',e),EVENT_HANDLER_ATTR_NOT_ALLOWED:i18n._('Sorry, but security restrictions on this site prevent you from using the "%(attribute_name_value)s" JavaScript event handler attribute.',e),HTML_CODE_IN_CSS_BLOCK:i18n._("Did you put HTML code inside a CSS area?",e),HTTP_LINK_FROM_HTTPS_PAGE:i18n._('The <%(openTag_name)s> tag\'s "%(attribute_name_value)s" attribute currently points to an insecure resource.',e),INVALID_URL:i18n._('The <%(openTag_name)s> tag\'s "%(attribute_name_value)s" attribute points to an invalid URL.  Did you include the protocol (http:// or https://)?',e),INVALID_ATTR_NAME:i18n._('The attribute name "%(attribute_name_value)s" is not permitted under HTML5 naming conventions.',e),UNSUPPORTED_ATTR_NAMESPACE:i18n._('The attribute "%(attribute_name_value)s" uses an attribute namespace that is not permitted under HTML5 conventions.',e),MULTIPLE_ATTR_NAMESPACES:i18n._('The attribute "%(attribute_name_value)s" has multiple namespaces. Check your text and make sure there\'s only a single namespace prefix for the attribute.',e),INVALID_CSS_PROPERTY_NAME:i18n._('The CSS property "%(cssProperty_property)s" isn\'t valid - property names can only have letters and dashes.',e),IMPROPER_CSS_VALUE:i18n._('The CSS value "%(cssValue_value)s" is malformed.',e),INVALID_TAG_NAME:i18n._('A "&lt;" character appears to be the beginning of a tag, but is not followed by a valid tag name. If you want a "&lt;" to appear on your Web page, try using "&amp;lt;" instead. Otherwise, check your spelling.',e),JAVASCRIPT_URL_NOT_ALLOWED:i18n._('Sorry, but security restrictions on this site prevent you from using the "javascript:" URL.',e),MISMATCHED_CLOSE_TAG:i18n._('You have a closing "&lt;/%(closeTag_name)s&gt;" tag that doesn\'t pair with the opening "&lt;%(openTag_name)s&gt;" tag. This is likely due to a missing or misordered "&lt;/%(openTag_name)s&gt;" tag.',e),MISSING_CSS_BLOCK_CLOSER:i18n._('You\'re missing either a "}" or another "property:value;" pair following "%(cssValue_value)s".',e),MISSING_CSS_BLOCK_OPENER:i18n._('You\'re missing the "{" after "%(cssSelector_selector)s".',e),MISSING_CSS_PROPERTY:i18n._('You\'re missing property for "%(cssSelector_selector)s".',e),MISSING_CSS_SELECTOR:i18n._('You\'re missing either a new CSS selector or the "&lt;/style&gt;" tag.',e),MISSING_CSS_VALUE:i18n._('You\'re missing value for "%(cssProperty_property)s".',e),SCRIPT_ELEMENT_NOT_ALLOWED:i18n._('Sorry, but security restrictions on this site prevent you from using "&lt;script&gt;" tags.',e),OBSOLETE_HTML_TAG:i18n._('The "%(openTag_name)s" tag is obsolete and may not function properly in modern browsers.',e),ELEMENT_NOT_ALLOWED:i18n._('Sorry, but security restrictions on this site prevent you from using "&lt;%(openTag_name)s&gt;" tags.',e),SELF_CLOSING_NON_VOID_ELEMENT:i18n._('The "&lt;%(name)s&gt;" tag can\'t be self-closed, because "&lt;%(name)s&gt;" is not a void element; it must be closed with a separate "&lt;/%(name)s&gt;" tag.',e),UNCAUGHT_CSS_PARSE_ERROR:i18n._('A parse error occurred outside expected cases: "%(error_msg)s"',e),UNCLOSED_TAG:i18n._('It looks like your "&lt;%(openTag_name)s&gt;" tag never closes.',e),UNEXPECTED_CLOSE_TAG:i18n._('You have a closing "&lt;/%(closeTag_name)s&gt;" tag that doesn\'t pair with any matching opening tags.',e),UNFINISHED_CSS_PROPERTY:i18n._('The CSS property "%(cssProperty_property)s" is missing a ":"',e),UNFINISHED_CSS_SELECTOR:i18n._('The CSS selector "%(cssSelector_selector)s" needs to be followed by "{"',e),UNFINISHED_CSS_VALUE:i18n._('The CSS value "%(cssValue_value)s" still needs to be finalized with ";"',e),UNKOWN_CSS_KEYWORD:i18n._('The CSS @keyword "%(cssKeyword_value)s" does not match any known @keywords.',e),UNKNOWN_CSS_PROPERTY_NAME:i18n._('The CSS property "%(cssProperty_property)s" is non-standard or non-existent. Check spelling and browser compatibility.',e),UNQUOTED_ATTR_VALUE:i18n._("Make sure your attribute value starts with an opening double quote.",e),UNTERMINATED_ATTR_VALUE:i18n._('It looks like your "&lt;%(openTag_name)s&gt;" tag\'s "%(attribute_name_value)s" attribute has a value that doesn\'t end with a closing double quote.',e),UNTERMINATED_CLOSE_TAG:i18n._('It looks like your closing "&lt;/%(closeTag_name)s&gt;" tag doesn\'t end with a "&gt;".',e),UNTERMINATED_COMMENT:i18n._('It looks like your comment doesn\'t end with a "--&gt;".',e),UNTERMINATED_CSS_COMMENT:i18n._('It looks like your CSS comment doesn\'t end with a "*/".',e),UNTERMINATED_OPEN_TAG:i18n._('It looks like your opening "&lt;%(openTag_name)s&gt;" tag doesn\'t end with a "&gt;".',e),UNKNOWN_SLOWPARSE_ERROR:i18n._("Something's wrong with the HTML, but we're not sure what."),JAVASCRIPT_ERROR:i18n._('Javascript Error:\n"%(message)s"',e)}[e.type]},initTests:function(t){if(t)try{new Function("with(arguments[0]){\n"+t+"\n}").apply({},this.tester.testContext)}catch(t){return t}},test:function(t,e,s,r){var n=s.length;_.extend(this.tester.testContext,{$doc:$(this.frameDoc),docSP:this.slowparseResults.document,cssRules:this.slowparseResults.rules}),this.tester.test(t,e,s,function(t,e){if(n!==t.length){var s=i18n._("Error: %(message)s",{message:t[t.length-1].message});console.warn(s),this.tester.testContext.assert(!1,s,i18n._("A critical problem occurred in your program making it unable to run."))}this.foundRunTimeError&&t.push(this.runtimeError),r(t,e)}.bind(this))},transformUrl:function(t){if(t.match(/^https?:\/\/([\w\d]+\.)?khanacademy\.org(\/|$)/))return t;var e=this.output.redirectUrl;return e&&0!==t.indexOf(e)?e+"?url="+encodeURIComponent(t):t},postProcessing:function(t){var e=this;$(this.frameDoc).find("a").each(function(t,e){var s=$(e).attr("href");s&&"#"!==s[0]&&"javascript"!==s.substring(0,10)&&($(e).attr("target","_blank"),$(e).attr("href",this.transformUrl(s)))}.bind(this)),$(this.frameDoc).find("a[href^='#']").on("mouseup",(function(){var t=$(this).attr("href");$(e.frameDoc).find(t).length&&$(e.frameDoc).find("html, body").animate({scrollTop:$(e.frameDoc).find(t).offset().top},1e3)}));var s=$(this.frameDoc).find("head > title"),r=s.first().text();s.length>=0&&this.oldPageTitle!==r&&(this.oldPageTitle=r,e.output.postParent({action:"page-info",title:r}))},runCode:function(t,e){this.stateScrubber.clearAll(),this.KA_INFINITE_LOOP=!1,this.foundRunTimeError=!1,this.frameDoc.open(),this.$frame.contentWindow.KAInfiniteLoopProtect=this.loopProtector.KAInfiniteLoopProtect,this.$frame.contentWindow.addEventListener("error",function(){this.foundRunTimeError=!0}.bind(this)),this.frameDoc.write(this.slowparseResults.code),this.frameDoc.close(),this.postProcessing(),this.KA_INFINITE_LOOP?e([this.infiniteLoopError]):e([])},clear:function(){},kill:function(){}}),LiveEditorOutput.registerOutput("webpage",WebpageOutput)}}]);
//# sourceMappingURL=../../sourcemaps/en/6s7b.e5dfedf0ba7efcf2f940.js.map