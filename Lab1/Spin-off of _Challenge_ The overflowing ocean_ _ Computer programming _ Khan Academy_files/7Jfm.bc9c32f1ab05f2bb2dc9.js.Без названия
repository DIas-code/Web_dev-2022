(window.webpackJsonp=window.webpackJsonp||[]).push([["7Jfm"],{qgfM:function(e,t,i){"use strict";var s=i("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.sanify=t.SuggestedClarificationModel=t.SuggestedClarificationCollection=t.ProjectEvalAnswerModel=t.DiscussionItemModel=t.DiscussionItemCollection=t.AnswerModel=t.AnswerCollection=void 0;var n=s(i("pVnL")),o=s(i("96rG")),r=s(i("ghyX")),a=s(i("EFbQ")),u=s(i("5pch")),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=l(t);if(i&&i.has(e))return i.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var r=n?Object.getOwnPropertyDescriptor(e,o):null;r&&(r.get||r.set)?Object.defineProperty(s,o,r):s[o]=e[o]}s.default=e,i&&i.set(e,s);return s}(i("4PhQ"));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(l=function(e){return e?i:t})(e)}const d=function(e){if(!e)return e;let t="abstain";if(e.upVoted?t="up":e.downVoted&&(t="down"),e.voteType=t,e.date&&(e.date=new Date(e.date)),e.author={kaid:e.authorKaid,nickname:e.authorNickname,avatarSrc:e.authorAvatarSrc},delete e.authorKaid,delete e.authorNickname,delete e.authorAvatarSrc,e.showLowQualityNotice){const{feedbackCode:t,feedbackType:i,feedbackChar:s}=e;e.lowQualityNotice={authorKaid:e.author.kaid,translatedFeedbackEditTip:(0,a.default)(t,i,s),translatedFeedbackType:"post",lowQualityScore:e.lowQualityScore},delete e.showLowQualityNotice,delete e.lowQualityScore,delete e.feedbackCode,delete e.feedbackType,delete e.feedbackChar}return e.shownLowQualityNotice=e.shownLowQualityNotice||!1,delete e.upVoted,delete e.downVoted,delete e.isQuestion,delete e.isAnswer,delete e.isComment,delete e.isReply,delete e.isScratchpad,delete e.isClarification,delete e.numberOfFlags,e};t.sanify=d;const f=r.default.Model.extend({idAttribute:"key",parse:d,defaults:{shownLowQualityNotice:!1},initialize:function(){c.default.error("Logging this usage of DiscussionItemModel.initialize to help with porting discussions to graphql",c.Errors.Internal)},urlRoutes:{createUpdate:function(){const e=`/api/internal/discussions/${this.getFocusKind()}/${this.getFocusId()}/${this.get("type")}`;return this.isNew()?`${e}?casing=camel`:`${e}/${this.id}?casing=camel`},destroy:function(){return`/api/internal/feedback/${this.get("key")}?casing=camel`}},toggleVote:function(e,t){const i=this.get("voteType"),s=this.get("sumVotesIncremented"),n={down:-1,abstain:0,up:1};let r=e,a=n[e];e===i&&(r="abstain",a*=-1);const u=s+a;this.set({voteType:r,sumVotesIncremented:u}),o.default.post("/api/internal/discussions/voteentity",{entity_key:this.id,vote_type:n[e]}).done((e=>{e&&e.error&&(this.set({voteType:i,sumVotesIncremented:s}),t(e.error))})).fail((()=>{this.set({voteType:i,sumVotesIncremented:s}),t("Log in first to vote")}))},save:function(e,t){return c.default.error("Logging this usage of DiscussionItemModel.save to help with porting discussions to graphql",c.Errors.Internal),this.unset("lowQualityNotice"),t=t?(0,u.default)(t).clone():{},(0,u.default)(t).extend({url:this.urlRoutes.createUpdate.apply(this),parse:!0}),r.default.Model.prototype.save.call(this,e,t)},destroy:function(e){if(c.default.error("Logging this usage of DiscussionItemModel.destroy to help with porting discussions to graphql",c.Errors.Internal),e=e?(0,u.default)(e).clone():{},(0,u.default)(e).extend({url:this.urlRoutes.destroy.apply(this),parse:!0}),this.get("inQueue")||this.userIsAuthor(e.profile))return r.default.Model.prototype.destroy.call(this,e);this.sync("delete",this,e),this.set("deleted",!0)},undelete:function(){o.default.ajax({type:"PUT",url:`/api/internal/feedback/${this.id}/undelete?casing=camel`,contentType:"application/json"}).then((()=>{this.set("deleted",!1)}))},convertTo:function(e){o.default.ajax({type:"PUT",url:`/api/internal/feedback/${this.id}/changetype?casing=camel`,contentType:"application/json",data:JSON.stringify({type:e}),dataType:"json"}).then((()=>{this.set({flags:[],flaggedBy:[]})}))},flag:function(e,t){const i={flag:e,justification:t,entity_key:this.id};o.default.ajax({type:"POST",url:"/api/internal/discussions/flagentity",dataType:"json",data:i}).then((()=>{this.set("flaggedByUser",!0)}))},clearFlags:function(){o.default.ajax({type:"PUT",url:`/api/internal/feedback/${this.id}/clearflags?casing=camel`,dataType:"json"})},markDuplicate:function(){this.set("duplicateNotice",!0)},unMarkDuplicate:function(){this.unset("duplicateNotice")},userIsAuthor:function(e){const t=this.get("author");return e&&t&&e.get("kaid")===t.kaid},getFocusKind:function(){return this.get("focusKind")||this.get("focus")&&this.get("focus").kind},getFocusId:function(){return this.get("focusId")||this.get("focus")&&this.get("focus").id},getTextContent:function(){return this.get("content")||this.get("text")||""},getThumbnailUrl:function(){return"scratchpad"===this.getFocusKind()?`${this.get("focus").relativeUrl}/latest.png`:null},getFocusUrlWithExpandKey:function(){return`${this.get("focus").relativeUrl}?qa_expand_key=${this.id}`},canHaveVotes:function(){return"reply"!==this.get("type")&&"projecteval"!==this.get("type")&&"projectevalanswer"!==this.get("type")},canHaveReplies:function(){return"clarification"===this.get("type")||"projecthelp"===this.get("type")||"answer"===this.get("type")},canHaveAnswers:function(){return"question"===this.get("type")||this.isProjectFeedbackRequest()||this.isProjectEval()},isProjectFeedbackRequest:function(){return"projecthelp"===this.get("type")||"projectcritique"===this.get("type")},isProjectHelp:function(){return"projecthelp"===this.get("type")},isProjectEval:function(){return"projecteval"===this.get("type")},isAnswer:function(){return"answer"===this.get("type")},isProjectEvalAnswer:function(){return"projectevalanswer"===this.get("type")},isEditable:function(){return"scratchpad"!==this.get("type")&&"reply"!==this.get("type")&&"projecteval"!==this.get("type")&&"projectevalanswer"!==this.get("type")},isFlaggable:function(){return!this.isProjectEval()&&!this.get("hideFlagControls")},hasAnswers:function(){return this.get("answers")&&this.get("answers").some((function(e){return!e.deleted}))},isPassingEvalAnswer:function(){return this.get("sumVotesIncremented")>1}});t.DiscussionItemModel=f;const h=r.default.Collection.extend({model:f,initialize:function(e,t){c.default.error("Logging this usage of DiscussionItemCollection.initialize to help with porting discussions to graphql",c.Errors.Internal),this.type=t.type,this.complete=!0,this.focusKind=t.focusKind,this.focusId=t.focusId,this.topic=t.topic,this.maxAnswers=t.maxAnswers,this.minAnswers=t.minAnswers,this.shuffle=t.shuffle,this.sortOrder=t.sortOrder,this.autoRefresh=t.autoRefresh,this.fetchCount=t.fetchCount},fetch:function(e){return r.default.Collection.prototype.fetch.call(this,(0,n.default)({},e,{success:(...t)=>(this.fetchedInitial=!0,this.trigger("change"),e&&e.success&&e.success.apply(e,t))}))},parse:function(e){let t=[];return e.feedback?(t=e.feedback,(0,u.default)(t).each((function(t){t.focus=t.focus||e.focus})),this.cursor=e.cursor,this.complete=e.complete):(t=e,(0,u.default)(t).each((e=>{e.focus={kind:this.focusKind,id:this.focusId}}))),t},findDuplicate:function(e){const t=e.getTextContent().toLowerCase();return this.find((function(e){return e.getTextContent().toLowerCase().indexOf(t)>-1}))},removeDuplicateNotice:function(){this.each((function(e){e.unMarkDuplicate()}))},url:function(){c.default.error("Logging this usage of DiscussionItemCollection.url to help with porting discussions to graphql",c.Errors.Internal,{sentryData:{contexts:{extras:{focusKind:this.focusKind,focusId:this.focusId,type:this.type}}}});let e="/api/internal/";const t={casing:"camel",limit:this.fetchCount||10};return this.focusId?e+=`discussions/${this.focusKind}/${this.focusId}/${this.type}`:(e+=this.type,t.topic=this.topic),this.cursor&&(t.cursor=this.cursor),null!=this.maxAnswers&&(t.max_answers=this.maxAnswers),null!=this.minAnswers&&(t.min_answers=this.minAnswers),this.sortOrder&&(t.sort=this.sortOrder),this.shuffle&&(t.shuffle=1),e+"?"+o.default.param(t)},isAllProjectHelpAnswered:function(){return this.every((function(e){return!e.isProjectHelp()||e.hasAnswers()}))},hasEvalRequests:function(){return this.some((function(e){return e.isProjectEval()}))},hasEvaluatedEvalRequests:function(){return this.some((function(e){return e.isProjectEval()&&e.hasAnswers()}))},hasPassingEvalRequests:function(){return this.some((function(e){return e.isProjectEval()&&e.get("answers")&&e.get("answers").some((function(e){return!e.deleted&&e.sumVotesIncremented>1}))}))},hasPendingEvalRequests:function(){return this.some((function(e){return e.isProjectEval()&&!e.hasAnswers()}))},hasHelpRequests:function(){return this.some((function(e){return e.isProjectHelp()}))},getOpenEvalRequest:function(){return this.find((function(e){return e.isProjectEval()&&!e.hasAnswers()}))},getEvalAnswer:function(){let e;return this.some((function(t){return t.isProjectEval()&&(e=(0,u.default)(t.get("answers")).find((function(e){return!e.deleted}))),!!e})),e&&new y(e)},getPassingEvalAnswer:function(){let e;return this.some((function(t){return t.isProjectEval()&&(e=(0,u.default)(t.get("answers")).find((function(e){return!e.deleted&&e.sumVotesIncremented>1}))),!!e})),e&&new y(e)},getBestEvalAnswer:function(){let e=this.getPassingEvalAnswer();return e||(e=this.getEvalAnswer()),e},isComplete:function(){return!!u.default.isUndefined(this.complete)||this.complete}},{fromItemAnswers:function(e){let t=[];return e.get("answers")&&(t=e.get("answers").map((function(t){const i=d(t);return i.focus=e.get("focus"),i}))),c.default.error("Logging this usage of creating an answer collection to help with porting discussions to graphql",c.Errors.Internal),new m(t,{focusKind:e.get("focus").kind,focusId:e.get("focus").id,type:"answer"})}});t.DiscussionItemCollection=h;const g=f.extend({initialize:function(){c.default.error("Logging this usage of SuggestedClarificationModel.initialize to help with porting discussions to graphql",c.Errors.Internal)},urlRoutes:{createUpdate:function(){return c.default.error("Logging this usage of SuggestedClarificationModel.urlRoutes.createUpdate to help with porting discussions to graphql",c.Errors.Internal,{sentryData:{contexts:{extras:{focusKind:this.get("focusKind"),focusId:this.get("focusId")}}}}),"/api/internal/discussions/"+this.get("focusKind")+"/"+this.get("focusId")+"/clarifications?casing=camel"},destroy:function(){return c.default.error("Logging this usage of SuggestedClarificationModel.urlRoutes.destroy to help with porting discussions to graphql",c.Errors.Internal),"/api/internal/feedback/"+this.get("key")+"?casing=camel"}}},{forVideoModel:function(e){return new g({focusKind:"youtubevideo",focusId:e.get("translatedYoutubeId"),content:""},{parse:!0})},forArticleId:function(e){return new g({focusKind:"article",focusId:e,content:""},{parse:!0})}});t.SuggestedClarificationModel=g;const p=h.extend({model:g,url:function(){return c.default.error("Logging this usage of SuggestedClarificationCollection.url to help with porting discussions to graphql",c.Errors.Internal,{sentryData:{contexts:{contexts:{articleId:this.articleId}}}}),this.articleId?p.urlForArticleId(this.articleId):p.urlForYoutubeId(this.videoModel.get("translatedYoutubeId"))},initialize:function(e,t){c.default.error("Logging this usage of SuggestedClarificationCollection.initialize to help with porting discussions to graphql",c.Errors.Internal),this.videoModel=t.videoModel,this.articleId=t.articleId},parse:function(e){const t=e.feedback;return(0,u.default)(t).each((function(t){t.focus=e.focus})),t}},{urlForYoutubeId:function(e){return"/api/internal/discussions/youtubevideo/"+e+"/clarifications?casing=camel"},urlForArticleId:function(e){return"/api/internal/discussions/article/"+e+"/clarifications?casing=camel"}});t.SuggestedClarificationCollection=p;const y=f.extend({answerType:"answers",initialize:function(){c.default.error("Logging this usage of AnswerModel.initialize to help with porting discussions to graphql",c.Errors.Internal)},save:function(e,t){return this.set({text:this.get("content"),content:void 0}),f.prototype.save.call(this,e,t)},urlRoutes:{createUpdate:function(){c.default.error("Logging this usage of AnswerModel.urlRoutes.createUpdate to help with porting discussions to graphql",c.Errors.Internal,{sentryData:{contexts:{extras:{questionKey:this.get("questionKey"),answerType:this.answerType}}}});const e=`/api/internal/questions/${this.get("questionKey")}/${this.answerType}`;return this.isNew()?e+"?casing=camel":`${e}/${this.get("key")}?casing=camel`},destroy:function(){return`/api/internal/feedback/${this.get("key")}?casing=camel&lang=en`}}});t.AnswerModel=y;const w=y.extend({answerType:"projectevalanswers",initialize:function(){c.default.error("Logging this usage of ProjectEvalAnswerModel.initialize to help with porting discussions to graphql",c.Errors.Internal)}});t.ProjectEvalAnswerModel=w;const m=h.extend({model:y,initialize:function(e,t){c.default.error("Logging this usage of AnswerCollection.initialize to help with porting discussions to graphql",c.Errors.Internal),h.prototype.initialize.call(this,e,t)},comparator:function(e,t){const i=e.get("date"),s=t.get("date");return i<s?-1:i>s?1:0}});t.AnswerCollection=m}}]);
//# sourceMappingURL=../../sourcemaps/en/7Jfm.bc9c32f1ab05f2bb2dc9.js.map