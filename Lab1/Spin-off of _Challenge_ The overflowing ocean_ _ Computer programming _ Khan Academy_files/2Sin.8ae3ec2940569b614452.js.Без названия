(window.webpackJsonp=window.webpackJsonp||[]).push([["2Sin"],{"M/o7":function(t,s,e){window.PooledWorker=function(t,s){this.pool=[],this.curID=0,this.filename=t,this.onExec=s||function(){}},PooledWorker.prototype.getURL=function(){return this.workersDir+this.filename+"?cachebust=G"+(new Date).toDateString()},PooledWorker.prototype.getWorkerFromPool=function(){var t=this.pool.shift();return t||(t=new window.Worker(this.getURL())),this.curID+=1,t.id=this.curID,t},PooledWorker.prototype.isCurrentWorker=function(t){return this.curID===t.id},PooledWorker.prototype.addWorkerToPool=function(t){this.pool.push(t)},PooledWorker.prototype.exec=function(){this.onExec.apply(this,arguments)},PooledWorker.prototype.kill=function(){this.pool.forEach((function(t){t.terminate()}),this),this.pool=[]},window.OutputTester=function(){},OutputTester.prototype={initialize:function(t){var s=this;for(var e in this.tests=[],this.testContext={},this.testMethods)this.testMethods.hasOwnProperty(e)&&(this.testContext[e]=this.testMethods[e]);for(var e in this.defaultTestContext)e in this.testContext||(this.testContext[e]=this.defaultTestContext[e]);"undefined"!=typeof PooledWorker&&(this.testWorker=new PooledWorker(t.workerFile,(function(t,e,i,r){var n=this;try{s.exec(e)}catch(t){return void console.warn(t.message)}if(!window.Worker||i.length>0)return s.test(t,e,i,r);var o=this.getWorkerFromPool();o.onmessage=function(t){if("test"===t.data.type&&(n.addWorkerToPool(o),n.isCurrentWorker(o))){var s=t.data.message;r(s.errors,s.testResults)}},o.postMessage({code:t,validate:e,errors:i,externalsDir:this.externalsDir,workersDir:this.workersDir})})))},bindTestContext:function(t){for(var s in t=t||this.testContext)"object"==typeof t[s]?this.bindTestContext(t[s]):"function"==typeof t[s]&&(t[s]=t[s].bind(this))},test:function(t,s,e,i){var r=[];e=this.errors=e||[],this.userCode=t,this.tests=[],this.exec(s),this.curTask=null,this.curTest=null;for(var n=0;n<this.tests.length;n++)r.push(this.runTest(this.tests[n],n));i(e,r)},runTest:function(t,s){var e={name:t.name,state:"pass",results:[]};return this.curTest=e,t.fn.call(this),this.curTest=null,e},exec:function(t){return!t||(t="with(arguments[0]){\n"+t+"\n}",new Function(t).call({},this.testContext),!0)},defaultTestContext:{test:function(t,s,e){s||(s=t,t=i18n._("Test Case")),this.tests.push({name:t,type:e||"default",fn:function(){try{return s.apply(this,arguments)}catch(t){console.warn(t)}}})},staticTest:function(t,s){this.testContext.test(t,s,"static")},log:function(t,s,e,i,r){var n={type:i=i||"info",msg:t,state:s,expected:e,meta:r||{}};return this.curTest&&("pass"!==s&&(this.curTest.state=s),this.curTest.results.push(n)),n},task:function(t,s){this.curTask=this.testContext.log(t,"pass",s,"task"),this.curTask.results=[]},endTask:function(){this.curTask=null},assert:function(t,s,e,i){return t=!!t,this.testContext.log(s,t?"pass":"fail",e,"assertion",i),t},isEqual:function(t,s,e){return this.testContext.assert(t===s,e,[t,s])},pass:function(t){return{success:!0,message:t}},fail:function(t){return{success:!1,message:t}},anyPass:function(){return _.find(arguments,this.testContext.passes)||arguments[0]||this.testContext.fail()},allPass:function(){return _.find(arguments,this.testContext.fails)||arguments[0]||this.testContext.pass()},passes:function(t){return t.success},fails:function(t){return!t.success}}},$._=i18n._,window.LiveEditorOutput=Backbone.View.extend({recording:!1,loaded:!1,outputs:{},lintErrors:[],runtimeErrors:[],lintWarnings:[],initialize:function(t){this.render(),this.setPaths(t),this.config=new ScratchpadConfig({}),t.outputType&&this.setOutput(t.outputType,!0,t.loopProtectTimeouts),this.lintErrors.timestamp=0,this.runtimeErrors.timestamp=0,this.lintWarnings.timestamp=0,this.bind()},render:function(){this.$el.html('<div class="output"></div>')},bind:function(){window.addEventListener("message",this.handleMessage.bind(this),!1)},setOutput:function(t,s,e){var i=this.outputs[t];this.output=new i({el:this.$el.find(".output"),config:this.config,output:this,type:t,enableLoopProtect:s,loopProtectTimeouts:e})},setPaths:function(t){t.workersDir&&(this.workersDir=this._qualifyURL(t.workersDir),PooledWorker.prototype.workersDir=this.workersDir),t.externalsDir&&(this.externalsDir=this._qualifyURL(t.externalsDir),PooledWorker.prototype.externalsDir=this.externalsDir),t.imagesDir&&(this.imagesDir=this._qualifyURL(t.imagesDir)),t.soundsDir&&(this.soundsDir=this._qualifyURL(t.soundsDir)),t.redirectUrl&&(this.redirectUrl=t.redirectUrl),t.jshintFile&&(this.jshintFile=this._qualifyURL(t.jshintFile),PooledWorker.prototype.jshintFile=this.jshintFile)},_qualifyURL:function(t){var s=document.createElement("a");return s.href=t,s.href},handleMessage:function(t){var s;if(this.frameSource=t.source,this.frameOrigin=t.origin,this.notifyActive(),"object"!=typeof t.data){try{s=JSON.parse(t.data)}catch(t){return}if(!this.output){var e=s.outputType||_.keys(this.outputs)[0],i=!0;null!=s.enableLoopProtect&&(i=s.enableLoopProtect);var r={initialTimeout:2e3,frameTimeout:500};null!=s.loopProtectTimeouts&&(r=s.loopProtectTimeouts),this.setOutput(e,i,r)}if(this.setPaths(s),null!=s.validate&&this.initTests(s.validate),null!=s.settings&&(this.settings=s.settings),null!=s.code&&(this.config.switchVersion(s.version),this.runCode(s.code,void 0,s.noLint)),null!=s.onlyRunTests?this.onlyRunTests=!!s.onlyRunTests:this.onlyRunTests=!1,s.restart&&this.restart(),null!=s.recording&&(this.recording=s.recording),null!=s.screenshot){var n=s.screenshotSize||200;this.output.getScreenshot(n,function(t){this.postParent(t)}.bind(this))}if(this.output.messageHandlers)for(var o in s)o in this.output.messageHandlers&&this.output.messageHandlers[o].call(this.output,s)}},postParent:function(t){if(this.frameSource){var s=this.frameSource;if(this.frameSource===window)return;s.postMessage("string"==typeof t?t:JSON.stringify(t),this.frameOrigin)}},notifyActive:_.once((function(){this.postParent({active:!0})})),initTests:function(t){this.validate!==t&&(this.validate=t)},jsonifyError:function(t){return"object"!=typeof t||$.isPlainObject(t)?t:{row:t.lineno?t.lineno-2:-1,column:0,text:t.message,type:"error",source:"native",priority:3}},runCode:function(t,s,e){this.currentCode=t;var i=Date.now();this.results={timestamp:i,code:t,errors:[],assertions:[],warnings:[]};var r=e&&this.firstLint;this.output.lint(t,r).then(function(s){return this.lintErrors=s.errors,this.lintErrors.timestamp=i,this.lintWarnings=s.warnings,this.lintWarnings.timestamp=i,this.lintDone(t,i)}.bind(this)).then(function(){this.buildDone(t,s)}.bind(this)),this.firstLint=!0},lintDone:function(t,s){var e=$.Deferred();if(this.lintErrors.length>0||this.onlyRunTests)return e.resolve(),e;try{this.output.runCode(t,function(t){this.runtimeErrors=t,this.runtimeErrors.timestamp=s,e.resolve()}.bind(this))}catch(t){this.outputs.hasOwnProperty("pjs")&&(this.runtimeErrors=[t]),e.resolve()}return e},buildDone:function(t,s){var e=[],i=[];this.results.timestamp===this.lintErrors.timestamp&&(e=e.concat(this.lintErrors)),this.results.timestamp===this.runtimeErrors.timestamp&&(e=e.concat(this.runtimeErrors)),this.results.timestamp===this.lintWarnings.timestamp&&(i=i.concat(this.lintWarnings)),e=(e=e||[]).map(this.jsonifyError),this.loaded||(this.postParent({loaded:!0}),this.loaded=!0),this.results.errors=e,this.results.warnings=i,this.phoneHome(),this.toggle(!e.length),s?this._test(t,this.validate,e,(function(t,e){s(t,e)})):""!==this.validate&&this.test(t,this.validate,e,function(t,s){this.results.errors=t,this.results.tests=s,this.phoneHome()}.bind(this))},phoneHome:function(){this.postParent({results:this.results})},test:_.throttle((function(){this._test.apply(this,arguments)}),200),_test:function(t,s,e,i){this.output.test(t,s,e,i)},lint:function(t,s){this.output.lint(t,s)},getUserCode:function(){return this.currentCode||""},toggle:function(t){this.output.toggle&&this.output.toggle(t)},restart:function(){this.output&&(this.output.restart&&this.output.restart(),this.runCode(this.getUserCode()))}}),LiveEditorOutput.registerOutput=function(t,s){LiveEditorOutput.prototype.outputs[t]=s},s.LiveEditorOutput=LiveEditorOutput}}]);
//# sourceMappingURL=../../sourcemaps/en/2Sin.8ae3ec2940569b614452.js.map