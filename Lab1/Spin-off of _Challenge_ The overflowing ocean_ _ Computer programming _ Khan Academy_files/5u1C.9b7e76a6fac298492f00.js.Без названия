(window.webpackJsonp=window.webpackJsonp||[]).push([["5u1C"],{TqfD:function(t,e,i){window.Handlebars=window.Handlebars||{},window.Handlebars.templates=window.Handlebars.templates||{},window.Handlebars.templates.tipbar=Handlebars.template({1:function(t,e,i,n,r){return"&times;"},compiler:[7,">= 4.0.0"],main:function(t,e,i,n,r){var s,o,a,d=null!=e?e:t.nullContext||{},l=i.helperMissing,h="function",c=t.escapeExpression,u='<div class="tipbar">\n    <div class="speech-arrow"></div>\n    <div class="error-buddy"></div>\n\n    <div class="text-wrap">\n        <button class="close" type="button" aria-label="Close">';return o=null!=(o=i.i18nDoNotTranslate||(null!=e?e.i18nDoNotTranslate:e))?o:l,a={name:"i18nDoNotTranslate",hash:{},fn:t.program(1,r,0),inverse:t.noop,data:r},s=typeof o===h?o.call(d,a):o,i.i18nDoNotTranslate||(s=i.blockHelperMissing.call(e,s,a)),null!=s&&(u+=s),u+'</button>\n        <div class="oh-no">'+c(typeof(o=null!=(o=i.ohNoesMsg||(null!=e?e.ohNoesMsg:e))?o:l)===h?o.call(d,{name:"ohNoesMsg",hash:{},data:r}):o)+'</div>\n        <div class="message"></div>\n        <div class="show-me"><a href>'+c(typeof(o=null!=(o=i.showMeMsg||(null!=e?e.showMeMsg:e))?o:l)===h?o.call(d,{name:"showMeMsg",hash:{},data:r}):o)+'</a></div>\n        <div class="tipnav">\n            <a href="javascript:void(0);" class="prev" title="'+c(typeof(o=null!=(o=i.prevMsg||(null!=e?e.prevMsg:e))?o:l)===h?o.call(d,{name:"prevMsg",hash:{},data:r}):o)+'">\n                <span class="ui-icon ui-icon-circle-triangle-w"></span>\n            </a>\n            <span class="current-pos"></span>\n            <a href="javascript:void(0);" class="next" title="'+c(typeof(o=null!=(o=i.nextMsg||(null!=e?e.nextMsg:e))?o:l)===h?o.call(d,{name:"nextMsg",hash:{},data:r}):o)+'">\n                <span class="ui-icon ui-icon-circle-triangle-e"></span>\n            </a>\n        </div>\n    </div>\n</div>'},useData:!0}),window.TipBar=Backbone.View.extend({initialize:function(t){this.liveEditor=t.liveEditor,this.pos=0,this.errors=[],this.render(),this.bind()},render:function(){this.$overlay=$('<div class="overlay error-overlay" style="display: none"></div>').appendTo(this.$el),this.$el.append(Handlebars.templates.tipbar({ohNoesMsg:i18n._("Oh noes!"),showMeMsg:i18n._("Show me where"),prevMsg:i18n._("Previous error"),nextMsg:i18n._("Next error")})),this.$bar=this.$el.find(".tipbar")},bind:function(){var t=this;$.fn.draggable&&this.$el.find(".tipbar").draggable({containment:"parent",handle:".error-buddy",axis:"y"}),this.$el.on("click",".tipbar .tipnav a",(function(e){return $(this).hasClass("ui-state-disabled")||(t.pos+=$(this).hasClass("next")?1:-1,t.update()),t.liveEditor.editor.focus(),!1})),this.$el.on("click",".tipbar .show-me a",(function(e){e.preventDefault();var i=t.errors[t.pos];return t.liveEditor.editor.setCursor(i),t.liveEditor.editor.setErrorHighlight(!0),!1})),this.$el.on("click",".tipbar .close",(function(e){t.liveEditor.setThinkingState()}))},setErrors:function(t){this.errors=t,this.update(!1)},update:function(t){if(this.errors.length){var e=this.errors,i=null==e[this.pos]?0:this.pos;this.$bar.find(".current-pos").text(e.length>1?i+1+"/"+e.length:"").end().find(".message").html(e[i].text||e[i]||"").end().find("a.prev").toggleClass("ui-state-disabled",0===i).end().find("a.next").toggleClass("ui-state-disabled",i+1===e.length).end(),this.$el.find(".show-me").toggle(e[i].row>-1),this.$bar.find(".tipnav").toggle(e.length>1),t&&(this.$overlay.show(),this.$bar.show())}},hide:function(){this.$bar.hide(),this.$overlay.hide(),clearTimeout(this.errorDelay)},toggleErrors:function(t,e){t.length>0?(this.$overlay.show(),this.setErrors(t),clearTimeout(this.errorDelay),this.errorDelay=setTimeout(function(){this.update(!0)}.bind(this),e)):this.hide()},setErrorPosition:function(t){this.pos=t,this.update(!0)}}),window.Handlebars=window.Handlebars||{},window.Handlebars.templates=window.Handlebars.templates||{},window.Handlebars.templates["live-editor"]=Handlebars.template({1:function(t,e,i,n,r){return" no-output"},3:function(t,e,i,n,r){var s,o=null!=e?e:t.nullContext||{},a=i.helperMissing,d="function",l=t.escapeExpression;return'                <iframe id="output-frame"\n                    src="'+l(typeof(s=null!=(s=i.execFile||(null!=e?e.execFile:e))?s:a)===d?s.call(o,{name:"execFile",hash:{},data:r}):s)+'"\n                    data-src="'+l(typeof(s=null!=(s=i.execFile||(null!=e?e.execFile:e))?s:a)===d?s.call(o,{name:"execFile",hash:{},data:r}):s)+'"></iframe>\n'},5:function(t,e,i,n,r){return"Loading..."},7:function(t,e,i,n,r){return"Hmm..."},9:function(t,e,i,n,r){return"Restart"},11:function(t,e,i,n,r){return'                <a href="" class="draw-color-button" id="'+t.escapeExpression(t.lambda(e,e))+'">\n                    <span></span>\n                </a>\n'},13:function(t,e,i,n,r){return"Record"},15:function(t,e,i,n,r){return"Enable Flash to load audio:"},17:function(t,e,i,n,r){return"Play"},19:function(t,e,i,n,r){return"Loading audio..."},compiler:[7,">= 4.0.0"],main:function(t,e,i,n,r){var s,o,a,d=null!=e?e:t.nullContext||{},l=i.helperMissing,h="function",c=t.escapeExpression,u=i.blockHelperMissing,p='<div class="scratchpad-wrap'+(null!=(s=i.unless.call(d,null!=e?e.execFile:e,{name:"unless",hash:{},fn:t.program(1,r,0),inverse:t.noop,data:r}))?s:"")+'">\n    \x3c!-- Canvases (Drawing + Output) --\x3e\n    <div class="scratchpad-canvas-wrap">\n        <div id="output">\n            \x3c!-- Extra data-src attribute to work around\n                 cross-origin access policies. --\x3e\n'+(null!=(s=i.if.call(d,null!=e?e.execFile:e,{name:"if",hash:{},fn:t.program(3,r,0),inverse:t.noop,data:r}))?s:"")+'            <canvas class="scratchpad-draw-canvas" style="display:none;"\n                width="400" height="400"></canvas>\n\n            <div class="overlay disable-overlay" style="display:none;">\n            </div>\n\n            <div class="scratchpad-canvas-loading">\n                <img src="'+c(typeof(o=null!=(o=i.imagesDir||(null!=e?e.imagesDir:e))?o:l)===h?o.call(d,{name:"imagesDir",hash:{},data:r}):o)+'/spinner-large.gif">\n                <span class="hide-text">';return o=null!=(o=i._||(null!=e?e._:e))?o:l,a={name:"_",hash:{},fn:t.program(5,r,0),inverse:t.noop,data:r},s=typeof o===h?o.call(d,a):o,i._||(s=u.call(e,s,a)),null!=s&&(p+=s),p+='</span>\n            </div>\n        </div>\n\n        <div class="scratchpad-toolbar">\n            <div class="error-buddy-resting">\n                <div class="error-buddy-happy" style="display:none;">\n                    <img src="'+c(typeof(o=null!=(o=i.imagesDir||(null!=e?e.imagesDir:e))?o:l)===h?o.call(d,{name:"imagesDir",hash:{},data:r}):o)+'/creatures/OhNoes-Happy.png"/>\n                </div>\n                <a class="error-buddy-thinking" style="display:none;" href="javascript:void()">\n                    <img src="'+c(typeof(o=null!=(o=i.imagesDir||(null!=e?e.imagesDir:e))?o:l)===h?o.call(d,{name:"imagesDir",hash:{},data:r}):o)+'/creatures/OhNoes-Hmm.png"/>\n                    ',o=null!=(o=i._||(null!=e?e._:e))?o:l,a={name:"_",hash:{},fn:t.program(7,r,0),inverse:t.noop,data:r},s=typeof o===h?o.call(d,a):o,i._||(s=u.call(e,s,a)),null!=s&&(p+=s),p+='\n                </a>\n            </div>\n            <button id="restart-code"\n                class="simple-button pull-right">\n                <span class="icon-refresh"></span>\n                ',o=null!=(o=i._||(null!=e?e._:e))?o:l,a={name:"_",hash:{},fn:t.program(9,r,0),inverse:t.noop,data:r},s=typeof o===h?o.call(d,a):o,i._||(s=u.call(e,s,a)),null!=s&&(p+=s),p+='</button>\n\n            \x3c!-- Widgets for selecting colors to doodle on the canvas during\n                recordings --\x3e\n            <div id="draw-widgets" style="display:none;">\n                <a href="" id="draw-clear-button" class="ui-button">\n                    <span class="ui-icon-cancel"></span>\n                </a>\n'+(null!=(s=i.each.call(d,null!=e?e.colors:e,{name:"each",hash:{},fn:t.program(11,r,0),inverse:t.noop,data:r}))?s:"")+'            </div>\n\n            \x3c!-- Record button --\x3e\n            <button id="record" class="simple-button pull-left" style="display:none;">',o=null!=(o=i._||(null!=e?e._:e))?o:l,a={name:"_",hash:{},fn:t.program(13,r,0),inverse:t.noop,data:r},s=typeof o===h?o.call(d,a):o,i._||(s=u.call(e,s,a)),null!=s&&(p+=s),p+='</button>\n        </div>\n    </div>\n\n    \x3c!-- Editor --\x3e\n    <div class="scratchpad-editor-wrap overlay-container">\n        <div class="scratchpad-editor-tabs">\n          <div id="scratchpad-code-editor-tab" class="scratchpad-editor-tab">\n            <div class="scratchpad-editor scratchpad-ace-editor"></div>\n            <div class="overlay disable-overlay" style="display:none;">\n            </div>\n\n            <div class="scratchpad-editor-bigplay-loading" style="display:none;">\n                <img src="'+c(typeof(o=null!=(o=i.imagesDir||(null!=e?e.imagesDir:e))?o:l)===h?o.call(d,{name:"imagesDir",hash:{},data:r}):o)+'/spinner-large.gif">\n                <span class="hide-text">',o=null!=(o=i._||(null!=e?e._:e))?o:l,a={name:"_",hash:{},fn:t.program(5,r,0),inverse:t.noop,data:r},s=typeof o===h?o.call(d,a):o,i._||(s=u.call(e,s,a)),null!=s&&(p+=s),p+='</span>\n            </div>\n\n            \x3c!-- This cannot be removed, if we want Flash to keep working! --\x3e\n            <div id="sm2-container">\n                ',o=null!=(o=i._||(null!=e?e._:e))?o:l,a={name:"_",hash:{},fn:t.program(15,r,0),inverse:t.noop,data:r},s=typeof o===h?o.call(d,a):o,i._||(s=u.call(e,s,a)),null!=s&&(p+=s),p+='\n                <br>\n            </div>\n\n            <button class="scratchpad-editor-bigplay-button" style="display:none;">\n                <span class="icon-play"></span>\n                <span class="hide-text">',o=null!=(o=i._||(null!=e?e._:e))?o:l,a={name:"_",hash:{},fn:t.program(17,r,0),inverse:t.noop,data:r},s=typeof o===h?o.call(d,a):o,i._||(s=u.call(e,s,a)),null!=s&&(p+=s),p+='</span>\n            </button>\n          </div>\n        </div>\n\n        <div class="scratchpad-toolbar">\n            \x3c!-- Row for playback controls --\x3e\n            <div class="scratchpad-playbar" style="display:none;">\n                <div class="scratchpad-playbar-area" style="display:none;">\n                    <button\n                        class="simple-button primary scratchpad-playbar-play"\n                        type="button">\n                        <span class="icon-play"></span>\n                    </button>\n\n                    <div class="scratchpad-playbar-progress"></div>\n\n                    <span class="scratchpad-playbar-timeleft"></span>\n                </div>\n                <div class="loading-msg">\n                    ',o=null!=(o=i._||(null!=e?e._:e))?o:l,a={name:"_",hash:{},fn:t.program(19,r,0),inverse:t.noop,data:r},s=typeof o===h?o.call(d,a):o,i._||(s=u.call(e,s,a)),null!=s&&(p+=s),p+'\n                </div>\n            </div>\n            <div class="scratchpad-debugger"></div>\n        </div>\n\n        <div class="scratchpad-toolbar scratchpad-dev-record-row" style="display:none;"></div>\n    </div>\n</div>'},useData:!0}),window.ScratchpadDrawCanvas=Backbone.View.extend({initialize:function(t){this.record=t.record,this.isDrawing=!1,this.ctx=this.el.getContext("2d"),this.ctx.shadowBlur=2,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.lineWidth=1,this.clear(!0),this.record&&this.bindRecordView()},commands:["startLine","drawLine","endLine","setColor","clear"],colors:{black:[0,0,0],red:[255,0,0],orange:[255,165,0],green:[0,128,0],blue:[0,0,255],lightblue:[173,216,230],violet:[128,0,128]},remove:function(){this.clear(!0),this.endDraw(),this.$el.off(".draw-canvas"),$(document).off(".draw-canvas")},bindRecordView:function(){var t=this,e=this.record;this.$el.on({"mousedown.draw-canvas":function(i){e.recording&&0===i.button&&(t.startLine(i.offsetX,i.offsetY),i.preventDefault())},"mousemove.draw-canvas":function(i){e.recording&&t.drawLine(i.offsetX,i.offsetY)},"mouseup.draw-canvas":function(i){e.recording&&t.endLine()},"mouseout.draw-canvas":function(i){e.recording&&t.endLine()}}),e.on("runSeek",(function(){t.clear(!0),t.endDraw()})),e.seekCachers.canvas={getState:function(){if(t.isDrawing){var e=document.createElement("canvas");return e.width=e.height=t.el.width,e.getContext("2d").drawImage(t.el,0,0),{x:t.x,y:t.y,down:t.down,color:t.color,canvas:e}}},restoreState:function(e){t.startDraw(),t.x=e.x,t.y=e.y,t.down=e.down,t.setColor(e.color);var i=t.ctx.shadowColor;t.ctx.shadowColor="rgba(0,0,0,0.0)",t.ctx.drawImage(e.canvas,0,0),t.ctx.shadowColor=i}},_.each(this.commands,(function(i){e.handlers[i]=function(){t[i].apply(t,arguments)}}))},startLine:function(t,e){this.down||(this.down=!0,this.x=t,this.y=e,this.record.log("startLine",t,e))},drawLine:function(t,e){this.down&&null!=this.x&&null!=this.y&&(this.ctx.beginPath(),this.ctx.moveTo(this.x,this.y),this.ctx.lineTo(t,e),this.ctx.stroke(),this.ctx.closePath(),this.x=t,this.y=e,this.record.log("drawLine",t,e))},endLine:function(){this.down&&(this.down=!1,this.record.log("endLine"))},setColor:function(t){null!=t&&(this.isDrawing||this.startDraw(!0),this.color=t,this.ctx.shadowColor="rgba("+this.colors[t]+",0.5)",this.ctx.strokeStyle="rgba("+this.colors[t]+",1.0)",this.record.log("setColor",t)),this.trigger("colorSet",t)},clear:function(t){this.ctx.clearRect(0,0,600,480),this.x=null,this.y=null,this.down=!1,!0!==t&&this.record.log("clear")},startDraw:function(t){this.isDrawing||(this.isDrawing=!0,!0!==t&&this.setColor("black"),this.trigger("drawStarted"))},endDraw:function(){this.isDrawing&&(this.isDrawing=!1,this.setColor(null),this.trigger("drawEnded"))}}),window.ScratchpadAudioChunks=Backbone.Model.extend({initialize:function(t){this.audioChunks=[],this.currentChunk=null},setCurrentChunk:function(t){this.currentChunk=t},currentChunkExists:function(){return!_.isNull(this.currentChunk)},startNewChunk:function(){this.currentChunk=null},discardCurrentChunk:function(){this.currentChunk=null},saveCurrentChunk:function(){this.currentChunk&&(this.audioChunks.push(this.currentChunk),this.currentChunk=null)},getAllChunks:function(){return this.audioChunks}}),window.ScratchpadRecordView=Backbone.View.extend({initialize:function(t){this.render(),this.$recordButton=t.recordButton,this.$finalSaveButton=t.saveButton,this.editor=t.editor,this.record=t.record,this.config=t.config,this.drawCanvas=t.drawCanvas,this.workersDir=t.workersDir,this.transloaditTemplate=t.transloaditTemplate,this.transloaditAuthKey=t.transloaditAuthKey,this.audioChunks=new ScratchpadAudioChunks,this.recordInProgress=!1,this.commandChunks=[],this.startingCode="",this.lastSavedCode=this.editor.text(),this.$lastAudioChunkElem=this.$el.find(".last-audio-chunk"),this.$savedAudioChunksElem=this.$el.find(".saved-audio-chunks"),this.initializeButtons()},render:function(){this.$el.html(Handlebars.templates["dev-record"]({})).show()},initializeButtons:function(){this.$newChunkButton=this.$el.find(".scratchpad-dev-new-chunk"),this.$discardChunkButton=this.$el.find(".scratchpad-dev-discard-chunk"),this.$saveChunkButton=this.$el.find(".scratchpad-dev-save-chunk"),this.$refreshEditorButton=this.$el.find(".scratchpad-dev-refresh-editor-state"),this.disableChunkButtons(!0,!0,!0,!0,!1),this.$newChunkButton.on("click",_.bind(this.newChunk,this)),this.$discardChunkButton.on("click",_.bind(this.discardChunk,this)),this.$saveChunkButton.on("click",_.bind(this.saveChunk,this)),this.$refreshEditorButton.on("click",_.bind(this.refreshEditor,this))},initializeRecordingAudio:function(){this.multirecorder=new MultiRecorder({workerPath:this.workersDir+"shared/multirecorder-worker.js"}),this.$recordButton.text("Use the chunks (and give permission)"),this.setButtonDisableStatus(this.$recordButton,!0),this.disableChunkButtons(!1,!0,!0,!0,!0)},startRecordingAudio:function(){var t=this;this.lastSavedCode=this.editor.text(),this.multirecorder.startRecording(1).progress(_.bind((function(t){this.$newChunkButton.text(t+"...")}),this)).done(_.bind((function(){this.disableChunkButtons(!1,!0,!0,!0,!0),t.record.recordingAudio=!0,this.$newChunkButton.html("Stop recording chunk"),this.startRecordingCommands()}),this))},stopRecordingAudio:function(){this.multirecorder.stopRecording().done(_.bind((function(t){this.audioChunks.setCurrentChunk(t),this.$lastAudioChunkElem.html(t.createAudioPlayer())}),this))},showSavedAudioChunks:function(){this.getFinalAudioRecording(_.bind((function(t){this.$savedAudioChunksElem.html(t.createAudioPlayer())}),this))},getDurationMsOfSavedAudio:function(){var t=0,e=$(this.$savedAudioChunksElem).find("audio");return e&&e.length>0&&(t=1e3*e[0].duration),t},startRecordingCommands:function(){if(this.record.hasNoChunks()){this.startingCode=this.editor.text();var t=this.config.curVersion();this.config.switchVersion(t),this.record.setActualInitData({configVersion:t,code:this.startingCode})}this.editor.focus(),this.record.startRecordChunk(this.getDurationMsOfSavedAudio()),this.record.log("select",0,0),this.editor.setCursor({row:0,column:0})},stopRecordingCommands:function(){this.record.stopRecordChunk()},getFinalAudioRecording:function(t){this.multirecorder.combineRecordings(this.audioChunks.getAllChunks()).done(t)},getFinalCommandRecording:function(){return this.record.dumpRecording()},newChunk:function(){this.audioChunks.currentChunkExists()||(this.recordInProgress?(this.recordInProgress=!1,this.stopRecordingCommands(),this.disableChunkButtons(!0,!1,!1,!0,!0),this.$newChunkButton.html("Start new chunk")):(this.editor.editor.setReadOnly(!1),this.recordInProgress=!0,this.startRecordingAudio()))},discardChunk:function(t){this.audioChunks.currentChunkExists()&&(this.audioChunks.discardCurrentChunk(),this.record.discardRecordChunk(),this.$lastAudioChunkElem.empty(),this.refreshEditor())},saveChunk:function(t){this.audioChunks.currentChunkExists()&&(this.audioChunks.saveCurrentChunk(),this.record.saveRecordChunk(),this.lastSavedCode=this.editor.text(),this.disableChunkButtons(!1,!0,!0,!1,!1),this.showSavedAudioChunks(),this.$lastAudioChunkElem.empty())},refreshEditor:function(t){this.record.loadRecording(this.record.dumpRecording()),this.editor.editor.setReadOnly(!1),this.record.initData=this.record.actualInitData,this.record.commands&&this.record.commands.push([this.getDurationMsOfSavedAudio(),"seek"]),this.record.time=0,this.editor.text(this.startingCode),this.drawCanvas.clear(!0),this.drawCanvas.endDraw(),this.record.seekTo(this.getDurationMsOfSavedAudio()),setTimeout(_.bind((function(){this.disableChunkButtons(!1,!0,!0,!1,!1)}),this),1e3)},disableChunkButtons:function(t,e,i,n,r){this.setButtonDisableStatus(this.$newChunkButton,t),this.setButtonDisableStatus(this.$discardChunkButton,e),this.setButtonDisableStatus(this.$saveChunkButton,i),this.setButtonDisableStatus(this.$refreshEditorButton,n),this.setButtonDisableStatus(this.$finalSaveButton,r)},setButtonDisableStatus:function(t,e){_.isUndefined(e)||t.prop("disabled",e)}}),$._=i18n._,window.LiveEditor=Backbone.View.extend({dom:{DRAW_CANVAS:".scratchpad-draw-canvas",DRAW_COLOR_BUTTONS:"#draw-widgets a.draw-color-button",CANVAS_WRAP:".scratchpad-canvas-wrap",EDITOR:".scratchpad-editor",CANVAS_LOADING:".scratchpad-canvas-loading",BIG_PLAY_LOADING:".scratchpad-editor-bigplay-loading",BIG_PLAY_BUTTON:".scratchpad-editor-bigplay-button",PLAYBAR:".scratchpad-playbar",PLAYBAR_AREA:".scratchpad-playbar-area",PLAYBAR_OPTIONS:".scratchpad-playbar-options",PLAYBAR_LOADING:".scratchpad-playbar .loading-msg",PLAYBAR_PROGRESS:".scratchpad-playbar-progress",PLAYBAR_PLAY:".scratchpad-playbar-play",PLAYBAR_TIMELEFT:".scratchpad-playbar-timeleft",PLAYBAR_UI:".scratchpad-playbar-play, .scratchpad-playbar-progress",OUTPUT_FRAME:"#output-frame",OUTPUT_DIV:"#output",ALL_OUTPUT:"#output, #output-frame",RESTART_BUTTON:"#restart-code",GUTTER_ERROR:".ace_error",ERROR_BUDDY_HAPPY:".error-buddy-happy",ERROR_BUDDY_THINKING:".error-buddy-thinking"},mouseCommands:["move","over","out","down","up"],colors:["black","red","orange","green","blue","lightblue","violet"],defaultOutputWidth:400,defaultOutputHeight:400,editors:{},initialize:function(t){this.workersDir=this._qualifyURL(t.workersDir),this.externalsDir=this._qualifyURL(t.externalsDir),this.imagesDir=this._qualifyURL(t.imagesDir),this.soundsDir=t.soundsDir,this.execFile=t.execFile?this._qualifyURL(t.execFile):"",this.jshintFile=this._qualifyURL(t.jshintFile||this.externalsDir+"jshint/jshint.js"),this.redirectUrl=t.redirectUrl,this.outputType=t.outputType||"",this.editorType=t.editorType||_.keys(this.editors)[0],this.editorHeight=t.editorHeight,this.initialCode=t.code,this.initialVersion=t.version,this.settings=t.settings,this.validation=t.validation,this.recordingCommands=t.recordingCommands,this.recordingMP3=t.recordingMP3,this.recordingInit=t.recordingInit||{code:this.initialCode,version:this.initialVersion},this.transloaditTemplate=t.transloaditTemplate,this.transloaditAuthKey=t.transloaditAuthKey,this.render(),this.config=new ScratchpadConfig({version:t.version}),this.record=new ScratchpadRecord,this.drawCanvas=new ScratchpadDrawCanvas({el:this.dom.DRAW_CANVAS,record:this.record}),this.drawCanvas.on({drawStarted:function(){this.$el.find(this.dom.DRAW_CANVAS).show()}.bind(this),drawEnded:function(){this.$el.find(this.dom.DRAW_CANVAS).hide()}.bind(this),colorSet:function(t){this.$el.find(this.dom.DRAW_COLOR_BUTTONS).removeClass("ui-state-active"),null!==t&&this.$el.find("#"+t).addClass("ui-state-active")}.bind(this)}),this.newErrorExperience=t.newErrorExperience,-1!==window.location.search.indexOf("new_error_experience=yes")&&(this.newErrorExperience=!0),null!=t.enableLoopProtect?this.enableLoopProtect=t.enableLoopProtect:this.enableLoopProtect=!0,this.editor=new this.editors[this.editorType]({el:this.dom.EDITOR,code:this.initialCode,autoFocus:t.autoFocus,config:this.config,record:this.record,imagesDir:this.imagesDir,soundsDir:this.soundsDir,externalsDir:this.externalsDir,workersDir:this.workersDir,type:this.editorType});var e=this.config.editor.tooltipEngine;e.setEnabledStatus&&(-1!==window.location.search.indexOf("autosuggestToggle=yes")?(window.localStorage.autosuggest="true",this.editor.editor.commands.addCommand({name:"toggleAutosuggest",bindKey:{win:"Ctrl+Alt+A",mac:"Command+Option+A"},exec:function(t){var i="true"===window.localStorage.autosuggest;e.setEnabledStatus(!0!==i),window.localStorage.setItem("autosuggest",String(!0!==i))}})):e.setEnabledStatus("true")),"ace_pjs"===this.editorType&&(this.noLint=!1,this.editor.on("scrubbingStarted",function(){this.noLint=!0}.bind(this)),this.editor.on("scrubbingEnded",function(){this.noLint=!1}.bind(this))),this.tipbar=new TipBar({el:this.$(this.dom.OUTPUT_DIV),liveEditor:this});var i=t.code;void 0!==i&&(this.editor.text(i),this.editor.originalCode=i),this.editor.focus(),t.cursor?this.editor.setCursor(t.cursor):this.editor.setSelection({start:{row:0,column:0},end:{row:0,column:0}}),this.$el.find("#page-overlay").hide(),this.updateCanvasSize(t.width,t.height),this.canRecord()&&this.$el.find("#record").show(),this.bind(),this.setupAudio()},render:function(){this.$el.html(Handlebars.templates["live-editor"]({execFile:this.execFile,imagesDir:this.imagesDir,colors:this.colors}))},bind:function(){var t=this,e=this,i=this.$el,n=this.dom;i.delegate(".simple-button.disabled, .ui-state-disabled","click",(function(t){return t.stopImmediatePropagation(),!1})),i.delegate(this.dom.RESTART_BUTTON,"click",this.restartCode.bind(this)),this.handleMessagesBound=this.handleMessages.bind(this),$(window).on("message",this.handleMessagesBound),i.find("#output-frame").on("load",(function(){t.outputState="clean",t.markDirty()})),this.editor.on("change",(function(){t.markDirty()})),this.editor.on("userChangedCode",(function(){t.record.recording||t.record.playing||t.trigger("userChangedCode")})),this.on("runDone",this.runDone.bind(this));this.editor.once("changeCursor",(function t(){"clean"!==e.outputState?e.once("runDone",t):setTimeout((function(){e.editor.getSelectionIndices&&e.postFrame({setCursor:e.editor.getSelectionIndices()}),e.editor.once("changeCursor",t)}),0),setTimeout((function(){e.maybeShowErrors()}),0)})),this.config.on("versionSwitched",function(t,e){this.markDirty(),this.config.runVersion(e,"jshint")}.bind(this)),this.hasAudio()&&(i.find(".overlay").show(),i.find(n.BIG_PLAY_LOADING).show(),i.find(n.PLAYBAR).show()),i.find(n.DRAW_COLOR_BUTTONS).each((function(){$(this).addClass("ui-button").children().css("background",this.id)})),jQuery.fn.buttonize&&i.buttonize(),i.on("buttonClick","a.draw-color-button",(function(){e.drawCanvas.setColor(this.id),e.editor.focus()})),i.on("click",".disable-overlay",(function(){e.record.pausePlayback()})),i.find(n.PLAYBAR_PROGRESS).slider({range:"min",value:0,min:0,max:100,start:function(){if(e.record.recording)return!1;e.record.seeking=!0,e.wasPlaying=e.record.playing,e.record.pausePlayback()},slide:function(t,i){var n=1e3*i.value;n!==e.record.endTime()&&(e.updateTimeLeft(n),e.seekTo(n))},stop:function(t,i){e.record.seeking=!1,e.updateTimeLeft(1e3*i.value),e.wasPlaying&&setTimeout((function(){e.record.play()}),1e3)}});var r=function(){e.record.playing?e.record.pausePlayback():e.record.play()};i.find(n.PLAYBAR_PLAY).off("click.play-button").on("click.play-button",r);if(this.on("readyToPlay",(function t(){i.find(n.PLAYBAR_LOADING).hide(),i.find(n.PLAYBAR_AREA).show(),i.find(n.BIG_PLAY_BUTTON).off("click.big-play-button").on("click.big-play-button",(function(){i.find(n.BIG_PLAY_BUTTON).hide(),r()})),i.find(n.PLAYBAR_PLAY).on("click",(function(){i.find(n.BIG_PLAY_BUTTON).hide()})),i.find(n.EDITOR).on("click",(function(){i.find(n.BIG_PLAY_BUTTON).hide()})),i.find(n.BIG_PLAY_LOADING).hide(),i.find(n.BIG_PLAY_BUTTON).show(),e.off("readyToPlay",t)})),i.on("buttonClick","#draw-clear-button",(function(){e.drawCanvas.clear(),e.drawCanvas.endDraw(),e.editor.focus()})),i.on("click",this.dom.RESTART_BUTTON,(function(){e.record.log("restart")})),i.on("click",this.dom.ERROR_BUDDY_THINKING,(function(){e.setErrorPosition(0)})),i.find("#record").on("click",(function(){e.recordHandler((function(t){t&&console.error(t)}))})),this.recordingCommands){var s=this.recordingMP3,o=/_x(1.\d+).mp3/.exec(s),a=parseFloat(o&&o[1])||1;this.record.loadRecording({init:this.recordingInit,commands:this.recordingCommands,multiplier:a})}},remove:function(){$(window).off("message",this.handleMessagesBound),this.editor.remove()},canRecord:function(){return this.transloaditAuthKey&&this.transloaditTemplate},hasAudio:function(){return!!this.recordingMP3},setupAudio:function(){if(this.hasAudio()){var t,e=this;soundManager.setup({url:this.externalsDir+"SoundManager2/swf/",debugMode:!1,useFlashBlock:!0,onready:function(){window.clearTimeout(t),e.audioInit()},ontimeout:function(i){window.clearTimeout(t),t=window.setTimeout((function(){e.$el.find("#sm2-container div").remove(),soundManager.reboot()}),3e3)}}),soundManager.beginDelayedInit(),this.bindRecordHandlers()}},audioInit:function(){if(this.hasAudio()){var t=this,e=this.record;this.wasPlaying=void 0,e.time=0,this.player=soundManager.createSound({id:"sound"+(new Date).getTime(),url:this.recordingMP3,autoLoad:!0,whileplaying:function(){t.updateTimeLeft(e.currentTime()),e.seeking||t.$el.find(t.dom.PLAYBAR_PROGRESS).slider("option","value",e.currentTime()/1e3),e.trigger("playUpdate")}.bind(this),onplay:function(){e.play()},onresume:function(){e.play()},onpause:function(){e.pausePlayback()},onload:function(){e.durationEstimate=e.duration=this.duration,e.trigger("loaded")},whileloading:function(){e.duration=null,e.durationEstimate=this.durationEstimate,e.trigger("loading")},onfinish:function(){e.stopPlayback(),e.trigger("playEnded")},onsuspend:function(){t.trigger("readyToPlay")}});var i=setInterval((function(){t.audioReadyToPlay()&&(clearInterval(i),t.trigger("readyToPlay"))}),16);this.bindPlayerHandlers()}},audioReadyToPlay:function(){return this.player&&(this.player.bytesLoaded>0||this.player.loaded)},bindPlayerHandlers:function(){var t=this,e=this.record;this.record.bind({loading:function(){t.updateDurationDisplay()},loaded:function(){var i=e.commands;i&&i.push([Math.max(e.endTime(),i[i.length-1][0]),"seek"]),t.updateDurationDisplay()},playStarted:function(){t.player.paused?t.player.resume():0===t.player.playState&&t.player.play()},playPaused:function(){t.player.pause()}})},bindRecordHandlers:function(){var t=this,e=this.record;e.bind({playStarted:function(i,n){t.config.switchVersion(e.getVersion()),e.recording||n||(t.editor.reset(e.initData.code,!1),t.drawCanvas.clear(!0),t.drawCanvas.endDraw()),e.recording||t.$el.find("#record").addClass("disabled"),t.$el.find(t.dom.RESTART_BUTTON).addClass("disabled"),e.recording||($("html").addClass("playing"),t.$el.find(".disable-overlay").show()),t.editor.unfold(),t.$el.find(t.dom.PLAYBAR_PLAY).find("span").removeClass("glyphicon-play icon-play").addClass("glyphicon-pause icon-pause")},playEnded:function(){t.config.switchVersion(this.initialVersion)},playPaused:function(){$("html").removeClass("playing"),t.$el.find(".disable-overlay").hide(),t.$el.find(t.dom.RESTART_BUTTON).removeClass("disabled"),t.$el.find("#record").removeClass("disabled"),t.$el.find(t.dom.PLAYBAR_PLAY).find("span").addClass("glyphicon-play icon-play").removeClass("glyphicon-pause icon-pause")},recordStarted:function(){t.postFrame({recording:!0}),t.$el.find("#draw-widgets").removeClass("hidden").show(),t.$el.find(".disable-overlay").hide(),t.editor.setReadOnly(!1),$("html").removeClass("playing"),e.hasNoChunks()&&(t.drawCanvas.clear(!0),t.drawCanvas.endDraw()),t.$el.find("#save-button, #fork-button").addClass("disabled"),t.$el.find("#record").addClass("toggled")},recordEnded:function(){t.postFrame({recording:!1}),e.recordingAudio&&t.recordView.stopRecordingAudio(),t.$el.find("#save-button, #fork-button").removeClass("disabled"),t.$el.find(t.dom.PLAYBAR_UI).removeClass("ui-state-disabled"),t.$el.find("#record").removeClass("toggled disabled"),e.stopPlayback(),t.$el.find(".disable-overlay").show(),$("html").addClass("playing"),t.editor.setReadOnly(!0),t.$el.find("#draw-widgets").addClass("hidden").hide(),t.drawCanvas.endDraw()}}),_.each(this.mouseCommands,(function(i){e.handlers[i]=function(e,n){t.postFrame({mouseAction:{name:i,x:e,y:n}})}})),e.handlers.restart=function(){var e=t.$el.find(t.dom.RESTART_BUTTON);e.hasClass("hilite")||(e.addClass("hilite green"),setTimeout((function(){e.removeClass("hilite green")}),300)),t.postFrame({restart:!0})},e.currentTime=function(){return t.player?t.player.position:0},e.endTime=function(){return this.duration||this.durationEstimate}},recordHandler:function(t){this.record.recording?this.recordView.stopRecordingCommands():this.editor.text()?this.config.curVersion()!==this.config.latestVersion()?t({error:"outdated"}):this.canRecord()&&!this.hasAudio()?(this.startRecording(),this.editor.focus()):t({error:"exists"}):t({error:"empty"})},startRecording:function(){if(this.bindRecordHandlers(),!this.recordView){var t=this.$el,e=this.workersDir.replace(/^https?:\/\/[^\/]*/,"");this.recordView=new ScratchpadRecordView({el:t.find(".scratchpad-dev-record-row"),recordButton:t.find("#record"),saveButton:t.find("#save-button"),record:this.record,editor:this.editor,config:this.config,workersDir:e,drawCanvas:this.drawCanvas,transloaditTemplate:this.transloaditTemplate,transloaditAuthKey:this.transloaditAuthKey})}this.recordView.initializeRecordingAudio()},saveRecording:function(t,e){if(!this.record.recorded||!this.record.recordingAudio)return t();var i=new TransloaditXhr({authKey:this.transloaditAuthKey,templateId:this.transloaditTemplate,steps:e,successCb:function(e){this.recordingMP3=e.mp3[0].url.replace(/^http:/,"https:"),t(null,this.recordingMP3)}.bind(this),errorCb:t});this.recordView.getFinalAudioRecording((function(t){i.uploadFile(t.wav)}))},updateDurationDisplay:function(){this.updateTimeLeft(this.record.currentTime()),this.$el.find(this.dom.PLAYBAR_PROGRESS).slider("option","max",this.record.endTime()/1e3)},updateTimeLeft:function(t){this.$el.find(".scratchpad-playbar-timeleft").text("-"+this.formatTime(this.record.endTime()-t))},formatTime:function(t){var e=t/1e3,i=Math.floor(e/60),n=Math.floor(e%60);return(i<0||n<0)&&(i=0,n=0),i+":"+(n<10?"0":"")+n},seekTo:function(t){this.record.seeking||this.$el.find(this.dom.PLAYBAR_PROGRESS).slider("option","value",t/1e3),!1!==this.record.seekTo(t)&&this.player.setPosition(t)},handleMessages:function(t){var e,i=t.originalEvent;try{e=JSON.parse(i.data)}catch(t){}if(e&&"object"==typeof e){if(this.trigger("update",e),(e.loaded||e.results)&&this.$el.find(this.dom.CANVAS_LOADING).hide(),void 0!==e.code&&(this.editor.text(e.code),this.editor.originalCode=e.code,this.restartCode()),void 0!==e.validate&&null!==e.validate&&(this.validation=e.validate),e.results&&this.trigger("runDone"),0===this.editorType.indexOf("ace_")&&e.results)if(this.removeUnderlineMarkers(),e.results.assertions||e.results.warnings){for(var n=[],r=0;r<e.results.assertions.length;r++){var s=e.results.assertions[r];n.push({row:+s.row,column:+s.column,text:s.text.toString(),type:"warning"}),this.addUnderlineMarker(+s.row)}for(r=0;r<e.results.warnings.length;r++){var o=e.results.warnings[r];n.push({row:+o.row,column:+o.column,text:o.text.toString(),type:"warning"}),this.addUnderlineMarker(+o.row)}this.editor.editor.session.setAnnotations(n)}else this.editor.editor.session.setAnnotations([]);this.newErrorExperience&&0===this.errorState.length&&this.setHappyState(),e.results&&_.isArray(e.results.errors)&&this.handleErrors(this.cleanErrors(e.results.errors)),void 0!==e.lines&&this.editor.toggleGutter(e.lines.map((function(t){return+t}))),e.restart&&this.restartCode(),e.log&&this.record.log.apply(this.record,e.log)}},addUnderlineMarker:function(t){var e=ace.require("ace/range").Range,i=this.editor.editor.session.getDocument().getLine(t);this.editor.editor.session.addMarker(new e(t,0,t,i.length),"ace_problem_line","text",!1)},removeUnderlineMarkers:function(){var t=this.editor.editor.session,e=t.getMarkers();Object.keys(e).forEach((function(e){t.removeMarker(e)}))},errorCursorRow:null,showError:null,handleErrors:function(t){if(this.newErrorExperience)if(window.clearTimeout(this.errorTimeout),t.length){this.editor.editor.session;this.removeUnderlineMarkers(),this.setErrors(t),this.maybeShowErrors()}else this.setErrors([]),this.setHappyState(),this.showError=!1,this.errorCursorRow=null;else this.tipbar.toggleErrors(t,1500)},maybeShowErrors:function(){if(this.hasErrors()&&this.editor&&this.editor.getCursor()){var t=this.editor.getCursor().row,e=null===this.errorCursorRow||this.errorCursorRow===t;null===this.errorCursorRow&&(this.errorCursorRow=t),this.showError=this.showError||!e||null===this.showError,this.showError?this.setErrorState():e&&(this.setThinkingState(),window.clearTimeout(this.errorTimeout),this.errorTimeout=setTimeout(function(){this.hasErrors()&&this.setErrorState()}.bind(this),6e4))}},errorState:"",hasErrors:function(){return this.tipbar.errors.length},setErrors:function(t){this.tipbar.setErrors(t)},setErrorPosition:function(t){this.setErrorState(),this.tipbar.setErrorPosition(t)},setErrorState:function(){this.errorState="error",this.$el.find(this.dom.ERROR_BUDDY_THINKING).hide(),this.$el.find(this.dom.ERROR_BUDDY_HAPPY).hide(),this.tipbar.update(!0)},setThinkingState:function(){"thinking"!==this.errorState&&(this.errorState="thinking",this.tipbar.hide(),this.$el.find(this.dom.ERROR_BUDDY_HAPPY).hide(),this.$el.find(this.dom.ERROR_BUDDY_THINKING).show().animate({left:-2},{duration:300,easing:"linear"}).animate({left:2},{duration:300,easing:"linear"}).animate({left:0},{duration:300,easing:"linear"}))},setHappyState:function(){this.errorState="happy",this.tipbar.hide(),this.$el.find(this.dom.ERROR_BUDDY_THINKING).hide(),this.$el.find(this.dom.ERROR_BUDDY_HAPPY).show()},postFrameOrigin:function(){var t=/^.*:\/\/[^\/]*/.exec(this.$el.find("#output-frame").attr("data-src"));return t?t[0]:window.location.protocol+"//"+window.location.host},postFrame:function(t){var e=this.$el.find("#output-frame")[0].contentWindow;e&&e.postMessage(JSON.stringify(t),this.postFrameOrigin())},hasFrame:function(){return!!this.execFile},restartCode:function(){this.postFrame({restart:!0})},runCode:_.throttle((function(t){var e={code:0===arguments.length?this.editor.text():t,cursor:this.editor.getSelectionIndices?this.editor.getSelectionIndices():-1,validate:this.validation||"",noLint:this.noLint,version:this.config.curVersion(),settings:this.settings||{},workersDir:this.workersDir,externalsDir:this.externalsDir,imagesDir:this.imagesDir,soundsDir:this.soundsDir,redirectUrl:this.redirectUrl,jshintFile:this.jshintFile,outputType:this.outputType,enableLoopProtect:this.enableLoopProtect};this.trigger("runCode",e),this.postFrame(e)}),20),markDirty:function(){var t=this;this.newErrorExperience||this.tipbar.hide(),"clean"===this.outputState?(setTimeout(this.runCode.bind(this),0),this.outputState="running",this.runTimeout=setTimeout((function(){t.trigger("runDone")}),500)):this.outputState="dirty"},runDone:function(){clearTimeout(this.runTimeout);var t=this.outputState;this.outputState="clean","dirty"===t&&this.markDirty()},outputState:"dirty",updateCanvasSize:function(t,e){t=t||this.defaultOutputWidth,e=e||this.defaultOutputHeight,this.$el.find(this.dom.CANVAS_WRAP).width(t),this.$el.find(this.dom.ALL_OUTPUT).height(e),this.$el.find(this.dom.EDITOR).height(this.editorHeight||e),this.trigger("canvasSizeUpdated",{width:t,height:e})},getScreenshot:function(t){if(!this.hasFrame()){var e=document.createElement("canvas");e.width=200,e.height=200;var i=e.getContext("2d"),n=this.editor.text(),r=(n=(n=(n=(n=(n=(n=(n=n.replace(/<[^>]+>/g,"")).replace(/&nbsp;|&#160;/g," ")).replace(/&lt;|&#60;/g,"<")).replace(/&gt;|&#62;/g,">")).replace(/&amp;|&#38;/g,"&")).replace(/&quot;|&#34;/g,'"')).replace(/&apos;|&#39;/g,"'")).split(/\s+/),s=0,o=r[0];i.font="24px serif";for(var a=1;a<r.length;a++){var d=r[a];i.measureText(o+" "+d).width<190?o+=" "+d:(s+=1,i.fillText(o,5,29*s),o=d)}return s+=1,i.fillText(o,5,29*s+5),void t(e.toDataURL("image/png"))}$(window).off("message.getScreenshot"),$(window).on("message.getScreenshot",(function(e){/^data:/.test(e.originalEvent.data)&&t(e.originalEvent.data)})),this.postFrame({screenshot:!0})},undo:function(){this.editor.undo()},_qualifyURL:function(t){var e=document.createElement("a");return e.href=t,e.href},cleanErrors:function(t){var e={WhileStatement:i18n._("A <code>while</code> loop is taking too long to run."),DoWhileStatement:i18n._("A <code>do-while</code> loop is taking too long to run."),ForStatement:i18n._("A <code>for</code> loop is taking too long to run."),FunctionDeclaration:i18n._("A <code>function</code> is taking too long to run."),FunctionExpression:i18n._("A <code>function</code> is taking too long to run.")};return t=(t=t.map(function(t){delete t.html;var i=t.infiniteLoopNodeType;i&&(t.html=i18n._("%(typeMessage)s Perhaps you have a mistake in your code?",{typeMessage:e[i]}));var n={};if("string"==typeof t?n.text=this.clean(this.prettify(t)):t.html?n.text=this.prettify(t.html):n.text=this.prettify(this.clean(t.text||t.message||"")),void 0!==t.lint){n.lint={};["character","line"].forEach((function(e){null!=t.lint[e]&&(n.lint[e]=+t.lint[e])})),["code","evidence","id","raw","reason","scope","type"].forEach((function(e){null!=t.lint[e]&&(n.lint[e]=t.lint[e].toString())})),["openTag"].forEach((function(e){null!=t.lint[e]&&(n.lint[e]=t.lint[e])}))}return null!=t.row&&(n.row=+t.row),null!=t.column&&(n.column=+t.column),null!=t.type&&(n.type=t.type.toString()),null!=t.source&&(n.source=t.source.toString()),null!=t.priority&&(n.priority=+t.priority),n}.bind(this))).sort((function(t,e){var i=t.row-e.row;return 0===i?(t.priority||99)-(e.priority||99):i}))},prettify:function(t){t=t.split('"');for(var e="",i=0;i<t.length;i++)0!==t[i].length&&(e+=i%2==0?'<span class="text">'+t[i]+"</span>":'<span class="quote">'+t[i]+"</span>");return e},clean:function(t){return String(t).replace(/</g,"&lt;")}}),LiveEditor.registerEditor=function(t,e){LiveEditor.prototype.editors[t]=e},e.LiveEditor=LiveEditor}}]);
//# sourceMappingURL=../../sourcemaps/en/5u1C.9b7e76a6fac298492f00.js.map